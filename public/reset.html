<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Restablecer contraseña - FIXALL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    padding: 0;
    background: radial-gradient(circle at top, #2f225f, #0f1020 55%, #02010a 100%);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;

    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.box {
    width: 100%;
    max-width: 420px;
    background: rgba(255,255,255,0.07);
    padding: 32px 28px;
    border-radius: 22px;
    text-align: center;
    border: 1px solid rgba(255,255,255,0.18);
    backdrop-filter: blur(14px);
    color: white;
}

input {
    width: 100%;
    padding: 15px;
    margin-top: 12px;
    border-radius: 14px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.18);
    color: white;
}

button {
    width: 100%;
    padding: 14px;
    margin-top: 18px;
    background: linear-gradient(135deg, #6c5ce7, #9b59b6);
    font-size: 16px;
    font-weight: 700;
    border-radius: 16px;
    color: white;
    border: none;
    cursor: pointer;
}

a { color: #a29bfe; }
</style>

<script type="module">
import { supabase } from "/js/supabase.js";

document.addEventListener("DOMContentLoaded", async () => {

    // 1) Revisar si hay un usuario autenticado por el enlace
    const { data, error } = await supabase.auth.getUser();

    if (error || !data.user) {
        alert("Acceso denegado. Usa el enlace enviado a tu correo.");
        window.location.href = "/forgot.html";
        return;
    }

    // 2) Solo si viene bien autenticado, permitimos cambiar la contraseña
    document.getElementById("resetBtn").addEventListener("click", async () => {
        const password = document.getElementById("password").value.trim();

        if (!password) {
            alert("Pon una nueva contraseña.");
            return;
        }

        const { error: updateError } = await supabase.auth.updateUser({
            password
        });

        if (updateError) {
            alert("Error actualizando: " + updateError.message);
            return;
        }

        alert("Contraseña actualizada. Ya puedes iniciar sesión.");
        window.location.href = "/login.html";
    });

});
</script>

</head>
<body>

<div class="box">
    <h2>Restablecer contraseña</h2>
    <p>Introduce tu nueva contraseña</p>

    <input id="password" type="password" placeholder="Nueva contraseña">

    <button id="resetBtn">Guardar contraseña</button>

    <p><a href="/login.html">Volver</a></p>
</div>

</body>
</html>
